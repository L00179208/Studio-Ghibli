<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: courses/src/api/services/courseService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: courses/src/api/services/courseService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Course = require("../../models/courseModel");
const Chapter = require("../../models/courseChapterModel");
const { Op } = require("sequelize");

/**
 * Service class for managing courses.
 * @namespace CourseService
 */
class CourseService {
  /**
   * Creates a new course.
   * @memberof CourseService
   * @param {Object} data - The data for creating the course.
   * @returns {Promise} - Returns a promise with the created course.
   */
  async createCourse(data) {
    try {
      const course = await Course.create(this.extractCourseFields(data));
      return course;
    } catch (error) {
      throw new Error(error.message);
    }
  }

  /**
   * Edits an existing course.
   * @memberof CourseService
   * @param {number} courseId - The ID of the course to edit.
   * @param {Object} data - The updated data for the course.
   * @returns {Promise} - Returns a promise with the updated course.
   */
  async editCourse(courseId, data) {
    try {
      const course = await Course.findByPk(courseId);
      if (!course) {
        throw new Error("Course not found!");
      }

      await course.update(this.extractCourseFields(data));
      await this.handleChapters(courseId, data.chapters);
      return course;
    } catch (error) {
      throw new Error(error.message);
    }
  }

  /**
   * Extracts course fields from data.
   * @memberof CourseService
   * @param {Object} data - The data containing course information.
   * @returns {Object} - Returns an object with extracted course fields.
   */
  extractCourseFields(data) {
    return {
      title: data.title,
      description: data.description,
      learning_outcomes: data.learning_outcomes,
      course_inclusions: data.course_inclusions,
      is_certified: data.is_certified,
      author: data.author,
      price: data.price,
      rating: data.rating,
      total_enrollments: data.total_enrollments,
      status: data.status,
      course_content: data.course_content,
    };
  }

  /**
   * Handles creation and updating of chapters for a course.
   * @memberof CourseService
   * @param {number} courseId - The ID of the course.
   * @param {Array} chapters - The chapters to be handled.
   * @returns {Promise} - Returns a promise.
   */
  async handleChapters(courseId, chapters) {
    if (chapters &amp;&amp; chapters.length > 0) {
      const chapterDataWithCourse = chapters.map((chapter) => ({
        ...chapter,
        course_id: courseId,
      }));

      await Chapter.destroy({ where: { course_id: courseId } });
      await Chapter.bulkCreate(chapterDataWithCourse);
    }
  }

  /**
   * Gets details of a course.
   * @memberof CourseService
   * @param {number} courseId - The ID of the course.
   * @returns {Promise} - Returns a promise with the course details.
   */
  async getCourseDetails(courseId) {
    try {
      let courseInfo = await Course.findByPk(courseId);
      const chapters = await Chapter.findAll({
        where: { course_id: courseId },
      });
      courseInfo = courseInfo.get({ plain: true });
      courseInfo.chapters = chapters;
      return courseInfo;
    } catch (error) {
      throw new Error("Course not found");
    }
  }

  /**
   * Deletes a course from the database.
   * @memberof CourseService
   * @param {number} courseId - The ID of the course to delete.
   * @returns {Promise} - Returns a promise with the deleted course.
   */
  async deleteCourse(courseId) {
    const course = await Course.findByPk(courseId);

    if (!course) {
      throw new Error("Course not found");
    } else {
      try {
        course.status = "-1";
        const deletedCourse = await course.save();
        return deletedCourse;
      } catch (error) {
        throw new Error(error.message);
      }
    }
  }

  /**
   * Fetches all courses that are not deleted.
   * @memberof CourseService
   * @param {string} searchTerm - The search term for filtering courses.
   * @param {string} order - The field to order courses by.
   * @param {string} sort - The sort order for ordering courses.
   * @returns {Promise} - Returns a promise with the fetched courses.
   */
  async getAllCourses(searchTerm, order, sort) {
    let options = {
      where: {
        status: { [Op.ne]: "-1" },
      },
    };

    if (searchTerm) {
      options.where.title = { [Op.like]: `%${searchTerm}%` };
    }

    if (order &amp;&amp; sort) {
      options.order = [[order, sort]];
    }

    try {
      const courses = await Course.findAll(options);
      return courses;
    } catch (error) {
      throw new Error(error);
    }
  }
}

module.exports = CourseService;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="CourseController.html">CourseController</a></li><li><a href="CourseService.html">CourseService</a></li><li><a href="authMiddleware.html">authMiddleware</a></li><li><a href="courseRoutes.html">courseRoutes</a></li></ul><h3>Classes</h3><ul><li><a href="CustomerService.html">CustomerService</a></li><li><a href="EnrollmentService.html">EnrollmentService</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CustomerController">CustomerController</a></li><li><a href="global.html#EnrollmentController">EnrollmentController</a></li><li><a href="global.html#sendResponse">sendResponse</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Apr 01 2024 17:03:19 GMT+0100 (Irish Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
